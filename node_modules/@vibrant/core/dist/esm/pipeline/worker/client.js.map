{"version":3,"file":"client.js","sources":["../../../../src/pipeline/worker/client.ts"],"sourcesContent":["import { WorkerManager } from \"@vibrant/worker\";\nimport { Swatch } from \"@vibrant/color\";\nimport { mapValues } from \"../../utils\";\nimport type { TaskWorkerClass } from \"@vibrant/worker\";\nimport type { Palette } from \"@vibrant/color\";\nimport type { Pipeline, ProcessOptions, ProcessResult } from \"../index\";\n\n/**\n * Client side (runs in UI thread)\n */\nexport class WorkerPipeline implements Pipeline {\n\tprivate _manager = new WorkerManager();\n\tconstructor(protected PipelineWorker: TaskWorkerClass) {\n\t\tthis._manager.register(\"pipeline\", PipelineWorker);\n\t}\n\tprivate _rehydrate(result: ProcessResult) {\n\t\tconst { colors, palettes } = result;\n\t\tresult.colors = colors.map((s) => Swatch.clone(s));\n\n\t\tresult.palettes = mapValues(\n\t\t\tpalettes,\n\t\t\t(p) => mapValues(p, (c) => (c ? Swatch.clone(c) : null)) as Palette,\n\t\t);\n\t\treturn result;\n\t}\n\tprocess(imageData: ImageData, opts: ProcessOptions): Promise<ProcessResult> {\n\t\treturn this._manager\n\t\t\t.invokeWorker(\"pipeline\", [imageData, opts], [imageData.data.buffer])\n\t\t\t.then((result) => this._rehydrate(result as ProcessResult));\n\t}\n}\n"],"names":[],"mappings":";;;AAUO,MAAM,eAAmC;AAAA,EAE/C,YAAsB,gBAAiC;AAAjC,SAAA,iBAAA;AADd,SAAA,WAAW,IAAI,cAAc;AAE/B,SAAA,SAAS,SAAS,YAAY,cAAc;AAAA,EAAA;AAAA,EAE1C,WAAW,QAAuB;AACnC,UAAA,EAAE,QAAQ,SAAA,IAAa;AACtB,WAAA,SAAS,OAAO,IAAI,CAAC,MAAM,OAAO,MAAM,CAAC,CAAC;AAEjD,WAAO,WAAW;AAAA,MACjB;AAAA,MACA,CAAC,MAAM,UAAU,GAAG,CAAC,MAAO,IAAI,OAAO,MAAM,CAAC,IAAI,IAAK;AAAA,IACxD;AACO,WAAA;AAAA,EAAA;AAAA,EAER,QAAQ,WAAsB,MAA8C;AACpE,WAAA,KAAK,SACV,aAAa,YAAY,CAAC,WAAW,IAAI,GAAG,CAAC,UAAU,KAAK,MAAM,CAAC,EACnE,KAAK,CAAC,WAAW,KAAK,WAAW,MAAuB,CAAC;AAAA,EAAA;AAE7D;"}